---
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const songs = await getCollection('songs');
  return songs.map((s) => ({ params: { slug: s.slug }, props: { song: s } }));
}

const { song } = Astro.props as { song: CollectionEntry<'songs'> };
const { data } = song;
---
<BaseLayout title={`${data.title} — The Rise and Fall of the Machine`}>
  <article class="prose prose-zinc max-w-3xl mx-auto">
    <p class="text-xs uppercase tracking-wide text-zinc-500">{data.act}</p>
    <h1 class="!mb-2">{data.title}</h1>
    {data.summary && <p class="text-zinc-600">{data.summary}</p>}
    <div class="my-6">
      {data.audio && <audio controls src={data.audio} class="w-full" />}
    </div>
    <div class="not-prose rounded-2xl bg-white/60 backdrop-blur border border-white p-5">
      <slot />
    </div>
    <div class="mt-8 grid sm:grid-cols-2 gap-4 not-prose">
      <a class="px-3 py-2 rounded-xl bg-black text-white hover:opacity-90" href="/machine/songs">← All songs</a>
      <a class="px-3 py-2 rounded-xl bg-white border border-black/10 hover:bg-white/80" href="/machine/story">Story</a>
    </div>
  </article>
</BaseLayout>
